<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator fichier svg</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/styles.css">
</head>

<body onLoad="checkValue()">
    <div class="container">
        <div class="row" style="margin-top:5px;">
            <div class="col" align="center"><img src="assets/img/logo_transparent.png">
                <h1 class="text-center">Générateur de fichier svg pour découpe de boites</h1>
            </div>
        </div>
        <div class="row" style="margin-top:15px;" align="center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Application</h5>
                    </div>
                    <div class="card-body">
                        <div id="Formulaire">
                            <div class="form-group"><label class="d-block float-left" style="width:150px;">Type de planche :</label><select onchange="getSelectedPlankIndex()" id="selectP"></select>
                                <button
                                class="btn btn-primary" type="button" style="margin-left:16px;" data-toggle="modal" data-target="#myModal">+</button>
                            </div>
                            <div
                            class="form-group"><label class="d-block float-left" style="width:150px;">Longueur :&nbsp;</label><input onkeyup ="checkValue()" id="longueur" type="number" placeholder="mm"></div>
                            <div class="form-group"><label class="d-block float-left" style="width:150px;">Largeur :&nbsp;</label><input onkeyup ="checkValue()" id="largeur" type="number" placeholder="mm"></div>
                            <div class="form-group"><label class="d-block float-left" style="width:150px;">Hauteur :&nbsp;</label><input onkeyup ="checkValue()" id="hauteur" type="number" placeholder="mm"></div>
                            <div class="form-group"><label class="d-block float-left" style="width:150px;">Epaisseur :&nbsp;</label><input onkeyup ="checkValue()" id="epaisseur" type="number" placeholder="mm"></div>
                            <div class="form-group"><label class="d-block float-left" style="width:150px;">Encoches :&nbsp;</label><input onkeyup ="checkValue()" id="encoche" type="number" placeholder="mm"></div>
                            <div class="form-group">
                                <div class="form-check"><input class="form-check-input" type="checkbox" id="formCheck-1"><label class="form-check-label" for="formCheck-1">Boite fermée</label></div>
                            </div><button id="genButton" class="btn btn-primary" type="button" onclick="tests()" >Générer la boite</button></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div>
                        <ul class="nav nav-tabs">
                            <li class="nav-item"><a class="nav-link active" role="tab" data-toggle="tab" href="#tab-1">Documentation</a></li>
                            <li class="nav-item"><a class="nav-link" role="tab" data-toggle="tab" href="#tab-2">Prévisualisation</a></li>
                            <li class="nav-item"><a class="nav-link" role="tab" data-toggle="tab" href="#tab-3">Infos</a></li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane active" role="tabpanel" id="tab-1">
                                <p><br>Ce formulaire permet de générer le plan de découpe d'une boîte fermée, ce plan est au format '.svg'. Le but principal est d'économiser au 
										maximum le passage du laser sur des mêmes bords de la boîte lors de la découpe, mais aussi de minimiser les chutes de bois pour permettre une éventuelle réutilisation
										de certaines chutes de bois. Vous pouvez choisir plusieurs modes de découpe en fonction de vos paramètres : par exemple vous pouvez découper une boîte entière, 
										ou deux boîte entière, ou un sous-ensemble, ou simplement un des morceaux / côtés de la boîte.<br><br></p>
                                </div>
                                <div class="tab-pane" role="tabpanel" id="tab-2">
                                    <a id="filesvg" >
                                    </a>
                                    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
                                    <svg
                                    xmlns:osb="http://www.openswatchbook.org/uri/2009/osb"
                                    xmlns:dc="http://purl.org/dc/elements/1.1/"
                                    xmlns:cc="http://creativecommons.org/ns#"
                                    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
                                    xmlns:svg="http://www.w3.org/2000/svg"
                                    xmlns="http://www.w3.org/2000/svg"
                                    xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
                                    xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
                                    width="100%"
                                    height="100%"
                                    version="1.1"
                                    id="svg"
                                    inkscape:version="0.92.3 (2405546, 2018-03-11)"
                                    sodipodi:docname="inkscape1test.svg"
                                    stroke="#ff0000" fill="#ffffff" fill-opacity="0">
                                    <defs
                                    id="defs3727">
                                    <linearGradient
                                    inkscape:collect="always"
                                    id="linearGradient4578"
                                    osb:paint="gradient">
                                    <stop
                                    style="stop-color:#000000;stop-opacity:1;"
                                    offset="0"
                                    id="stop4574" />
                                    <stop
                                    style="stop-color:#000000;stop-opacity:0;"
                                    offset="1"
                                    id="stop4576" />
                                </linearGradient>
                            </defs>
                            <sodipodi:namedview
                            id="base"
                            pagecolor="#ffffff"
                            bordercolor="#666666"
                            borderopacity="1.0"
                            inkscape:pageopacity="0.0"
                            inkscape:pageshadow="2"
                            inkscape:zoom="0.7"
                            inkscape:cx="280.75598"
                            inkscape:cy="674.9179"
                            inkscape:document-units="mm" 
                            units="mm"
                            inkscape:current-layer="layer1"
                            showgrid="false"
                            inkscape:window-width="1600"
                            inkscape:window-height="837"
                            inkscape:window-x="-8"
                            inkscape:window-y="-8"
                            inkscape:window-maximized="1" />
                            <metadata
                            id="metadata3730">
                            <rdf:RDF>
                            <cc:Work
                            rdf:about="">
                            <dc:format>image/svg+xml</dc:format>
                            <dc:type
                            rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
                            <dc:title></dc:title>
                        </cc:Work>
                    </rdf:RDF>
                </metadata>
                <g id="svginfo" inkscape:label="Calque 1" inkscape:groupmode="layer" id="layer1">
                   <!-- your path goes here my dear -->
               </g>
           </svg>
       </div>
       <div class="tab-pane" role="tabpanel" id="tab-3">
        <p><br>Pour plus de détails sur les différents paramètres :<br> ( intégrer shéma ici ? )</p>
    </div>
</div>
</div>
</div>
</div>
</div>
<div id="myModal" role="dialog" tabindex="-1" class="modal fade">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Ajout de planche</h4><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div>
                <div class="modal-body">
                    <p>Entrez les dimension du support sur lequel vous souhaitez découper votre boite
                    (cela rajoutera des planches provisoirement)</p>
                    <div class="form-group"><label>Nom :</label><input onkeyup ="checkValueModal()" id='pName' type="text" /></div>
                    <div class="form-group"><label>Longueur :</label><input onkeyup ="checkValueModal()" id='pLenght' type="number" placeholder="mm" /></div>
                    <div class="form-group"><label>Largeur :</label><input onkeyup ="checkValueModal()" id='pWidth' type="number" placeholder="mm" /></div>
                    <div class="form-group"><label>Epaisseur :</label><input onkeyup ="checkValueModal()" id='pThick' type="number" placeholder="mm" /></div>
                </div>
                <div class="modal-footer"><button class="btn btn-light" type="button" data-dismiss="modal">Close</button><button id="pButton" onclick="addPlank()" data-dismiss="modal" class="btn btn-primary" type="button">Save</button></div>
            </div>
        </div>
    </div>
    <script type="text/javascript">


        function addPlank(){

            var name = document.getElementById('pName').value;
            var lenght = Number(document.getElementById("pLenght").value);
            var width = Number(document.getElementById("pWidth").value);
            var thick = Number(document.getElementById("pThick").value);
            var planche = new Planche(name,lenght,width,thick);

            selectPlanche.push(planche);
            removeOptions(document.getElementById("selectP"));
            updateSelectPlank(selectPlanche);
        }

        function removeOptions(selectbox)
        {
            var i;
            for(i = selectbox.options.length - 1 ; i >= 0 ; i--)
            {
                selectbox.remove(i);
            }
        }
        function addOption(selectBox,element){
            var option = document.createElement("option");
            option.text = element;
            selectBox.add(option);
        }
        function updateSelectPlank(array){
            select = document.getElementById("selectP");
            removeOptions(document.getElementById("selectP"));
            var i = 0;
            for(i = select.options.lenght - 1; i >=0; i--){
                console.log("ça remove");
                selectBox.remove(i);
            }
            for(i = 0;i<array.length;i++){
                addOption(select,array[i].name+"("+array[i].width+"x"+array[i].height+"x"+array[i].thickness+"mm)");
                select.options[i].setAttribute("id",array[i].id);
            }
        }
        var Planche = (function(){
            var nextId = 1;
            return function Planche(name,width,height,thickness){
                this.name = name;
                this.width = width;
                this.height  = height;
                this.thickness = thickness;
                this.id = nextId++;
            }
            
        })();

        var planche1 = new Planche("planche1",120,70,1);

        var indexSelection = 0;
        var selectPlanche = [];
        selectPlanche = [];
        selectPlanche.push(planche1);
        updateSelectPlank(selectPlanche);

        document.getElementById("genButton").disabled = true;
        document.getElementById("pButton").disabled = true;

        function isNumeric(a) {
            var b = a && a.toString();
            return !$.isArray(a) && b - parseFloat(b) + 1 >= 0;
        };


        function checkValueModal(){
            var name = document.getElementById('pName').value;
            var lenght = Number(document.getElementById("pLenght").value);
            var width = Number(document.getElementById("pWidth").value);
            var thick = Number(document.getElementById("pThick").value);
            var valid = isNumeric(lenght) && isNumeric(width) && isNumeric(thick) && name;
            document.getElementById("pButton").disabled = !valid;

        }

        function checkValue(){
            var length = document.getElementById("longueur").value;
            var witdh = document.getElementById("largeur").value;
            var thickness = document.getElementById("epaisseur").value;
            var height = document.getElementById("hauteur").value;
            var notch = document.getElementById("encoche").value;
            var valid = isNumeric(length) && isNumeric(witdh) && isNumeric(height) && isNumeric(notch) && isNumeric(thickness);
            document.getElementById("genButton").disabled = !valid;
        }

        function getSelectedPlankIndex(){
            var select = document.getElementById('selectP');
            selectedOption = select.options[select.selectedIndex];
            var plankId = Number(selectedOption.getAttribute("id"));
            var i = 0;
            for(i=0;i<selectPlanche.length;i++){
                if(selectPlanche[i].id == plankId){
                    indexSelection = i;
                }
            }
        }
    //checkValue();
</script>
<script src="generate_svg_boxes.js"></script>
<script src="assets/js/jquery.min.js"></script>
<script src="assets/bootstrap/js/bootstrap.min.js"></script>
</body>

</html>